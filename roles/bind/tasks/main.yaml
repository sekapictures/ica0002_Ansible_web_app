- name: Install bind9
  ansible.builtin.apt:
    name: 
      - bind9
      - bind9-utils
    state: latest

- name: Place bind9 configuration
  ansible.builtin.template:
    src: named.conf.options.j2
    dest: /etc/bind/named.conf.options
  notify: 
    - Restart bind9 service
    - Stop systemd-resolved
    - Place resolv.conf 

- name: Place database configuration
  ansible.builtin.template:
    src: "{{ db_name }}"
    dest: /var/cache/bind/"{{ db_name }}"
  notify:
    - Reload database

- name: Place named.conf.local.j2 
  ansible.builtin.template:
    src: named.conf.local.j2
    dest: /etc/bind/named.conf.local
  notify: 
    - Restart bind9 service
    - Stop systemd-resolved
    - Place resolv.conf 

- name: Ensure bind9 is started
  ansible.builtin.service:
    name: bind9
    enabled: yes
    state: started