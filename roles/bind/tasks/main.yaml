- name: Install bind9
  ansible.builtin.apt:
    name: 
      - bind9
      - bind9-utils
    state: latest

- name: Place bind9 configuration
  ansible.builtin.template:
    src: named.conf.options.j2
    dest: /etc/bind/named.conf.options
    mode: '0766'
  notify: 
    - Restart bind9 service
    # - Stop systemd-resolved
    # - Delete resolv.conf link
    # - Place resolv.conf 

- name: Place database configuration
  ansible.builtin.template:
    src: "{{ db_name }}"
    dest: /var/cache/bind/
    mode: '0766'
  notify:
    - Reload database

- name: Place named.conf.local.j2 
  ansible.builtin.template:
    src: named.conf.local.j2
    dest: /etc/bind/named.conf.local
    mode: '0766'
  notify: 
    - Restart bind9 service
    - Stop systemd-resolved
    - Delete resolv.conf link
    - Place resolv.conf 

- name: Ensure bind9 is started
  ansible.builtin.service:
    name: bind9
    enabled: yes
    state: started