server {
	listen 80 default_server;
	server_name ubuntu@{{ ansible_host }};

{% if inventory_hostname in groups['web_servers'] %}
	location / {
		uwsgi_pass localhost:5000;
		include uwsgi_params;
	}
{% endif %}

	location /node-metrics {
		proxy_pass http://localhost:9100/metrics;
	}

	location /nginx-metrics {
		proxy_pass http://localhost:9113/metrics;
	}

{% if inventory_hostname in groups['prometheus'] %}
	location /prometheus {
		proxy_pass http://localhost:9090;
	}
{% endif %}

{% if inventory_hostname in groups['grafana'] %}

	location /mysql-metrics {
		proxy_pass http://localhost:9104/metrics;
	}

	location /bind-metrics {
		proxy_pass http://localhost:9119/metrics;
	}

	location /grafana {
		proxy_pass http://localhost:3000;
	}

	location /influxdb-metrics {
		proxy_pass http://localhost:9424/metrics;
	}
{% endif %}

}